#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

if [[ $# -eq 0 || "${1:-}" == "-h" || "${1:-}" == "--help" ]]; then
  cat <<'EOF'
Agent Wrangler shortcuts:
  start
    -> routed to: teams up --rebuild --mode import --preserve-duplicates --startup --agent --nav --manager --manager-replace
  up|bootstrap|import|attach|status|paint|watch|manager|nav|send|stop|restart|agent|focus|kill|shell|layout|capture|projects|doctor|drift
    -> routed to: teams <command>
  fleet ...
    -> routed to: teams fleet ...
  program ...
    -> routed to: program_orchestrator.py
  overview
    -> routed to: ui

Examples:
  ./scripts/agent-wrangler start
  ./scripts/agent-wrangler up --rebuild --mode import --preserve-duplicates --max-panes 10 --nav --manager --manager-replace
  ./scripts/agent-wrangler fleet manager --replace --update-defaults
  ./scripts/agent-wrangler drift --fleet --alert-dirty 25
  ./scripts/agent-wrangler program phases --refresh-state
  ./scripts/agent-wrangler program promote
  ./scripts/agent-wrangler program loop --iterations 1 --apply-safe --write-report
  ./scripts/agent-wrangler program daemon --apply-guardrails
EOF
  echo ""
  exec python3 "$SCRIPT_DIR/command_center.py" --help
fi

case "${1:-}" in
  start)
    shift
    set -- teams up --rebuild --mode import --preserve-duplicates --max-panes "${AW_MAX_PANES:-10}" --startup --agent --nav --manager --manager-replace "$@"
    ;;
  up|bootstrap|import|attach|status|paint|watch|manager|nav|send|stop|restart|agent|focus|kill|shell|layout|capture|projects|doctor|drift)
    set -- teams "$@"
    ;;
  fleet)
    set -- teams "$@"
    ;;
  program)
    shift
    exec python3 "$SCRIPT_DIR/program_orchestrator.py" "$@"
    ;;
  overview)
    shift
    set -- ui "$@"
    ;;
esac

exec python3 "$SCRIPT_DIR/command_center.py" "$@"
